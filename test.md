# 订单管理系统设计方案

## 1. 系统概述

### 1.1 业务背景
本系统是一个订单管理系统，用于管理与供应商之间的订单。业务流程为：从供应商获得产品 → 加价报给代理 → 代理把订单给用户。系统主要由用户和供应商使用，不需要代理直接使用，但需要管理不同代理的产品价格。

### 1.2 核心功能
- 客户管理：管理客户的护照信息和签证信息
- 产品管理：管理供应商给的产品与报价
- 订单管理：记录订单信息和业务信息
- 账单管理：管理付款凭证与生成账单
- 代理管理：管理不同代理的产品价格

## 2. 数据结构设计

### 2.1 客户管理模块
#### 2.1.1 护照信息表（Passport）
- ID（主键）
- 客户姓名
- 护照号码
- 国籍
- 出生日期
- 性别
- 护照签发日期
- 护照有效期
- 备注
- 创建时间
- 更新时间

#### 2.1.2 签证信息表（Visa）
- ID（主键）
- 护照ID（外键，关联护照信息表）
- 签证类型
- 签发国家/地区
- 签发日期
- 有效期
- 入境次数（单次/多次）
- 签证状态（有效/过期/即将过期）
- 备注
- 创建时间
- 更新时间

### 2.2 产品管理模块
#### 2.2.1 产品信息表（Product）
- ID（主键）
- 产品名称
- 产品类型（可以是枚举：旅游产品、酒店、机票等）
- 产品描述
- 产品详情
- 产品状态（上架/下架）
- 备注
- 创建时间
- 更新时间

#### 2.2.2 产品报价表（ProductQuote）
- ID（主键）
- 产品ID（外键，关联产品信息表）
- 供应商ID（外键，关联供应商表）
- 成本价格
- 备注
- 创建时间
- 更新时间

#### 2.2.3 代理产品价格表（AgentProductPrice）
- ID（主键）
- 产品报价ID（外键，关联产品报价表）
- 代理ID（外键，关联代理表）
- 成本价格
- 销售价格
- 备注
- 创建时间
- 更新时间

### 2.3 订单管理模块
#### 2.3.1 订单主表（Order）
- ID（主键）
- 订单编号（业务编号，可读性强）
- 客户ID（外键，关联护照信息表）
- 代理ID（外键，关联代理表）
- 订单总金额
- 订单状态（待处理/处理中/已取消/已完成）
- 支付状态（未支付/部分支付/已支付）
- 下单日期
- 备注
- 创建人
- 创建时间
- 更新时间

#### 2.3.2 订单明细表（OrderItem）
- ID（主键）
- 订单ID（外键，关联订单主表）
- 产品ID（外键，关联产品信息表）
- 产品报价ID（外键，关联产品报价表）
- 代理产品价格ID（外键，关联代理产品价格表）
- 数量
- 单价
- 小计金额
- 备注
- 创建时间
- 更新时间

### 2.4 账单管理模块
#### 2.4.1 账单主表（Invoice）
- ID（主键）
- 账单编号（业务编号，可读性强）
- 客户ID（外键，关联护照信息表）
- 代理ID（外键，关联代理表）
- 账单总金额
- 已支付金额
- 未支付金额
- 账单状态（未支付/部分支付/已支付）
- 生成日期
- 备注
- 创建人
- 创建时间
- 更新时间

#### 2.4.2 账单订单关联表（InvoiceOrder）
- ID（主键）
- 账单ID（外键，关联账单主表）
- 订单ID（外键，关联订单主表）
- 金额
- 状态（有效/取消）
- 创建时间
- 更新时间

#### 2.4.3 支付记录表（Payment）
- ID（主键）
- 账单ID（外键，关联账单主表）
- 支付金额
- 支付方式（银行转账/现金/其他）
- 支付日期
- 支付状态（待审核/已审核/已拒绝）
- 凭证图片URL
- 审核人
- 审核时间
- 审核备注
- 创建时间
- 更新时间

### 2.5 辅助模块
#### 2.5.1 用户表（User）
- ID（主键）
- 用户名
- 密码（加密存储）
- 姓名
- 角色（管理员/普通用户/供应商）
- 状态（启用/禁用）
- 最后登录时间
- 创建时间
- 更新时间

#### 2.5.2 供应商表（Supplier）
- ID（主键）
- 供应商名称
- 联系人
- 联系电话
- 地址
- 状态（合作中/已终止）
- 备注
- 创建时间
- 更新时间

#### 2.5.3 代理表（Agent）
- ID（主键）
- 代理名称
- 联系人
- 联系电话
- 地址
- 状态（合作中/已终止）
- 备注
- 创建时间
- 更新时间

#### 2.5.4 配置表（Config）
- ID（主键）
- 配置键
- 配置值
- 配置描述
- 创建时间
- 更新时间

#### 2.5.5 操作日志表（OperationLog）
- ID（主键）
- 用户ID
- 操作类型
- 操作内容
- 操作时间
- IP地址
- 设备信息

## 3. 功能模块设计

### 3.1 用户认证与授权
- 用户登录/登出
- 密码重置
- 权限管理（基于角色的访问控制）

### 3.2 客户管理功能
- 客户信息的增删改查
- 护照信息管理
- 签证信息管理
- 客户信息导入/导出

### 3.3 产品管理功能
- 产品信息的增删改查
- 产品报价管理
- 代理产品价格管理
- 产品信息导入/导出

### 3.4 订单管理功能
- 订单创建/修改/取消
- 订单状态跟踪
- 订单查询和筛选
- 订单导出

### 3.5 账单管理功能
- 账单生成
- 支付记录管理
- 支付凭证上传和审核
- 账单状态更新
- 账单导出

### 3.6 系统管理功能
- 用户管理
- 供应商管理
- 代理管理
- 系统配置
- 日志查询

## 4. 业务流程设计

### 4.1 产品管理流程
1. 创建产品基本信息
2. 添加供应商报价
3. 设置代理销售价格
4. 上架/下架产品

### 4.2 订单管理流程
1. 选择客户
2. 选择产品和数量
3. 生成订单
4. 确认订单
5. 更新订单状态

### 4.3 账单管理流程
1. 选择订单生成账单
2. 发送账单给客户
3. 上传支付凭证
4. 管理员审核支付凭证
5. 更新账单和订单的支付状态

## 5. 技术架构设计

### 5.1 系统架构
- 前端：采用现代化的前端框架，如React或Vue.js，实现响应式设计，支持PC端和移动端访问
- 后端：采用Node.js/Express或Spring Boot等框架，提供RESTful API
- 数据库：MySQL或PostgreSQL关系型数据库
- 文件存储：用于存储支付凭证等图片，可以使用云存储服务或本地文件系统
- 认证与授权：JWT（JSON Web Token）实现无状态认证

### 5.2 技术选型
#### 5.2.1 前端技术栈
- React/Vue.js作为前端框架
- Ant Design/Element UI作为UI组件库
- Redux/Vuex管理状态
- Axios处理HTTP请求
- ECharts实现数据可视化（报表功能）

#### 5.2.2 后端技术栈
- Node.js + Express/Spring Boot作为后端框架
- Sequelize/MyBatis作为ORM框架
- JWT实现认证
- Multer处理文件上传
- Nodemailer发送邮件通知

#### 5.2.3 数据库
- MySQL/PostgreSQL
- Redis用于缓存和会话管理

#### 5.2.4 部署
- Docker容器化
- Nginx作为Web服务器和反向代理
- PM2进程管理（Node.js）

### 5.3 系统安全考虑
- 密码加密存储
- HTTPS加密传输
- SQL注入防护
- XSS和CSRF防护
- 接口访问权限控制
- 敏感操作日志记录

### 5.4 性能优化
- 数据库索引优化
- 查询缓存
- 前端资源压缩和CDN加速
- 分页查询和懒加载

## 6. 开发计划

### 6.1 开发阶段划分
#### 6.1.1 第一阶段：核心功能开发
- 用户认证与授权
- 客户管理模块
- 产品管理模块
- 订单管理模块
- 账单管理模块

#### 6.1.2 第二阶段：辅助功能开发
- 供应商管理
- 代理管理
- 系统配置
- 基础报表功能

#### 6.1.3 第三阶段：高级功能开发
- 高级报表和数据分析
- 自动化通知（邮件、短信）
- API接口（供第三方系统集成）
- 移动端适配优化

### 6.2 开发优先级
#### 6.2.1 最高优先级
- 用户认证与授权
- 客户管理（护照和签证信息）
- 产品管理（产品和报价信息）

#### 6.2.2 高优先级
- 订单管理
- 账单管理
- 支付凭证管理

#### 6.2.3 中优先级
- 供应商管理
- 代理管理
- 基础报表

#### 6.2.4 低优先级
- 高级报表和数据分析
- 自动化通知
- API接口
- 移动端优化

### 6.3 开发时间估计
- 第一阶段：2-3个月
- 第二阶段：1-2个月
- 第三阶段：2-3个月
- 测试和优化：1个月

### 6.4 测试计划
- 单元测试
- 集成测试
- 用户验收测试
- 性能测试
- 安全测试

### 6.5 上线策略
- 先内部测试
- 小范围用户测试
- 全面上线
- 持续监控和优化
