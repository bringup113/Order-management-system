import{_ as M,M as h,b as q,r as v,x as C,c as I,y as F,o as V,e as Y,i as x,z as U,f as o,w as r,E as y,A as N,k as E,X as R,Y as T,Z as w,n as b,V as B,W as L,s as O,q as P,P as S,N as j,O as z,t as A,g as G}from"./index-518491b2.js";/* empty css                *//* empty css                     *//* empty css                 *//* empty css                       *//* empty css                 *//* empty css               *//* empty css                  */import{b as W,u as X,c as Z}from"./visa-d4042f05.js";const H={name:"VisaForm",setup(){const d=h(),a=q(),D=v(null),e=v(!1),f=v(!1),c=v([]),s=C(()=>d.query.passportId),u=C(()=>d.name==="VisaEdit"),t=I({id:null,passportId:s.value||null,visaType:"",issueCountry:"",issueDate:"",expiryDate:"",entryCount:"single",status:"valid",remark:""}),m={passportId:[{required:!0,message:"请选择关联护照",trigger:"change"}],visaType:[{required:!0,message:"请输入签证类型",trigger:"blur"}],issueCountry:[{required:!0,message:"请输入签发国家/地区",trigger:"blur"}],issueDate:[{required:!0,message:"请选择签发日期",trigger:"change"}],expiryDate:[{required:!0,message:"请选择有效期",trigger:"change"}],entryCount:[{required:!0,message:"请选择入境次数",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},p=i=>{i?(f.value=!0,p({keyword:i}).then(n=>{c.value=n.data||[]}).catch(n=>{console.error("搜索护照失败",n),y.error("搜索护照失败")}).finally(()=>{f.value=!1})):c.value=[]},_=i=>{e.value=!0,W(i).then(n=>{Object.assign(t,n.data)}).catch(n=>{console.error("获取签证详情失败",n),y.error("获取签证详情失败")}).finally(()=>{e.value=!1})},k=()=>{D.value.validate(i=>{if(i)e.value=!0,(u.value?X(t.id,t):Z(t)).then(()=>{y.success(u.value?"修改成功":"添加成功"),s.value?a.push(`/customer/passport/detail/${s.value}`):a.push("/customer/visa/list")}).catch(l=>{console.error(u.value?"修改签证失败":"添加签证失败",l),y.error(u.value?"修改签证失败":"添加签证失败")}).finally(()=>{e.value=!1});else return!1})},g=()=>{s.value?a.push(`/customer/passport/detail/${s.value}`):a.push("/customer/visa/list")};return F(()=>{u.value&&d.params.id&&_(d.params.id)}),{formRef:D,form:t,rules:m,submitLoading:e,passportLoading:f,passportOptions:c,passportId:s,isEdit:u,searchPassports:p,submitForm:k,cancel:g}}},J={class:"visa-form-container"},K={class:"visa-form-header"};function Q(d,a,D,e,f,c){const s=B,u=L,t=O,m=P,p=S,_=j,k=z,g=A,i=G,n=N;return V(),Y("div",J,[x("div",K,[x("h2",null,U(e.isEdit?"编辑签证":"新增签证"),1)]),o(n,{class:"form-container"},{default:r(()=>[o(i,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"120px","label-position":"right"},{default:r(()=>[e.passportId?w("",!0):(V(),E(t,{key:0,label:"护照信息"},{default:r(()=>[o(u,{modelValue:e.form.passportId,"onUpdate:modelValue":a[0]||(a[0]=l=>e.form.passportId=l),placeholder:"请选择关联护照",filterable:"",remote:"","remote-method":e.searchPassports,loading:e.passportLoading},{default:r(()=>[(V(!0),Y(R,null,T(e.passportOptions,l=>(V(),E(s,{key:l.id,label:`${l.name} (${l.passportNo})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","loading"])]),_:1})),o(t,{label:"签证类型",prop:"visaType"},{default:r(()=>[o(m,{modelValue:e.form.visaType,"onUpdate:modelValue":a[1]||(a[1]=l=>e.form.visaType=l),placeholder:"请输入签证类型"},null,8,["modelValue"])]),_:1}),o(t,{label:"签发国家/地区",prop:"issueCountry"},{default:r(()=>[o(m,{modelValue:e.form.issueCountry,"onUpdate:modelValue":a[2]||(a[2]=l=>e.form.issueCountry=l),placeholder:"请输入签发国家/地区"},null,8,["modelValue"])]),_:1}),o(t,{label:"签发日期",prop:"issueDate"},{default:r(()=>[o(p,{modelValue:e.form.issueDate,"onUpdate:modelValue":a[3]||(a[3]=l=>e.form.issueDate=l),type:"date",placeholder:"选择签发日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(t,{label:"有效期至",prop:"expiryDate"},{default:r(()=>[o(p,{modelValue:e.form.expiryDate,"onUpdate:modelValue":a[4]||(a[4]=l=>e.form.expiryDate=l),type:"date",placeholder:"选择有效期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(t,{label:"入境次数",prop:"entryCount"},{default:r(()=>[o(k,{modelValue:e.form.entryCount,"onUpdate:modelValue":a[5]||(a[5]=l=>e.form.entryCount=l)},{default:r(()=>[o(_,{label:"single"},{default:r(()=>a[8]||(a[8]=[b("单次")])),_:1}),o(_,{label:"multiple"},{default:r(()=>a[9]||(a[9]=[b("多次")])),_:1})]),_:1},8,["modelValue"])]),_:1}),o(t,{label:"状态",prop:"status"},{default:r(()=>[o(u,{modelValue:e.form.status,"onUpdate:modelValue":a[6]||(a[6]=l=>e.form.status=l),placeholder:"请选择状态"},{default:r(()=>[o(s,{label:"有效",value:"valid"}),o(s,{label:"过期",value:"expired"}),o(s,{label:"即将过期",value:"expiring"})]),_:1},8,["modelValue"])]),_:1}),o(t,{label:"备注",prop:"remark"},{default:r(()=>[o(m,{modelValue:e.form.remark,"onUpdate:modelValue":a[7]||(a[7]=l=>e.form.remark=l),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["modelValue"])]),_:1}),o(t,null,{default:r(()=>[o(g,{type:"primary",onClick:e.submitForm,loading:e.submitLoading},{default:r(()=>a[10]||(a[10]=[b("保存")])),_:1},8,["onClick","loading"]),o(g,{onClick:e.cancel},{default:r(()=>a[11]||(a[11]=[b("取消")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}const ue=M(H,[["render",Q],["__scopeId","data-v-d3e9ac81"]]);export{ue as default};
