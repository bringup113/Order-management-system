import{_ as N,M as B,b as R,r as _,y as U,o as f,e as M,i as u,f as t,w as o,J as O,k as C,E as A,Q as j,t as F,A as z,a5 as L,L as q,n as i,X as G,z as l,Z as J,R as Q,F as X,S as Z,D as H,G as K,q as W}from"./index-518491b2.js";/* empty css                   *//* empty css                   *//* empty css                *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                             */import{a as Y,b as $}from"./invoice-101f2e3d.js";const ee={name:"InvoiceDetail",setup(){const T=B(),r=R(),g=_(!1),e=_(null),v=_([]),w=_(!1),p=_(""),s=async()=>{const n=T.params.id;if(!n){A.error("账单ID不能为空");return}g.value=!0;try{const c=await Y(n);e.value=j(c),m(n)}catch(c){console.error("获取账单详情失败:",c),A.error("获取账单详情失败"),e.value={id:n,invoiceNo:"INV20230001",generatedDate:"2023-01-15",status:"partial",totalAmount:5e3,paidAmount:2e3,unpaidAmount:3e3,createdBy:"管理员",createdAt:"2023-01-15 10:30:00",updatedAt:"2023-01-16 14:20:00",remarks:"这是一个测试账单",passport:{name:"张三",passportNo:"E12345678",nationality:"中国"},agent:{name:"北京旅行社",contactPerson:"赵六",contactPhone:"13600136000"},orders:[{id:1,orderNo:"ORD20230001",orderDate:"2023-01-10",orderStatus:"completed",amount:3e3,status:"active"},{id:2,orderNo:"ORD20230002",orderDate:"2023-01-12",orderStatus:"processing",amount:2e3,status:"active"}]},v.value=[{id:1,paymentAmount:2e3,paymentMethod:"bank",paymentDate:"2023-01-16",paymentStatus:"approved",reviewedBy:"管理员",reviewedAt:"2023-01-16 14:20:00",reviewRemarks:"支付凭证已确认",voucherUrl:"https://example.com/voucher1.jpg"}]}finally{g.value=!1}},m=async n=>{try{const c=await $(n);v.value=c.data||[]}catch(c){console.error("获取支付记录失败:",c),v.value=[{id:1,paymentAmount:2e3,paymentMethod:"bank",paymentDate:"2023-01-16",paymentStatus:"approved",reviewedBy:"管理员",reviewedAt:"2023-01-16 14:20:00",reviewRemarks:"支付凭证已确认",voucherUrl:"https://example.com/voucher1.jpg"}]}},y=()=>{r.back()},d=()=>{r.push({name:"InvoiceEdit",params:{id:e.value.id}})},b=()=>{r.push({name:"InvoicePayments",params:{id:e.value.id}})},h=n=>{p.value=n,w.value=!0},D=n=>({unpaid:"未支付",partial:"部分支付",paid:"已支付"})[n]||n,k=n=>({unpaid:"danger",partial:"warning",paid:"success"})[n]||"",S=n=>({pending:"待处理",processing:"处理中",completed:"已完成",cancelled:"已取消"})[n]||n,a=n=>({pending:"warning",processing:"primary",completed:"success",cancelled:"danger"})[n]||"",x=n=>({cash:"现金",bank:"银行转账",other:"其他"})[n]||n,I=n=>({pending:"待审核",approved:"已审核",rejected:"已拒绝"})[n]||n,V=n=>({pending:"warning",approved:"success",rejected:"danger"})[n]||"",E=n=>`¥ ${parseFloat(n).toFixed(2)}`,P=n=>n?new Date(n).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"";return U(()=>{s()}),{loading:g,invoice:e,payments:v,voucherDialogVisible:w,currentVoucherUrl:p,goBack:y,handleEdit:d,handlePayments:b,previewVoucher:h,getInvoiceStatusText:D,getInvoiceStatusType:k,getOrderStatusText:S,getOrderStatusType:a,getPaymentMethodText:x,getPaymentStatusText:I,getPaymentStatusType:V,formatCurrency:E,formatDateTime:P}}},te={class:"invoice-detail-container"},ae={class:"page-header"},oe={class:"header-actions"},ne={key:1},re={class:"voucher-container"},ie=["src"];function le(T,r,g,e,v,w){const p=F,s=Q,m=X,y=Z,d=H,b=K,h=W,D=z,k=L,S=q;return f(),M("div",te,[u("div",ae,[r[5]||(r[5]=u("h1",null,"账单详情",-1)),u("div",oe,[t(p,{onClick:e.goBack},{default:o(()=>r[2]||(r[2]=[i("返回")])),_:1},8,["onClick"]),t(p,{type:"primary",onClick:e.handleEdit},{default:o(()=>r[3]||(r[3]=[i("编辑账单")])),_:1},8,["onClick"]),t(p,{type:"success",onClick:e.handlePayments},{default:o(()=>r[4]||(r[4]=[i("支付记录")])),_:1},8,["onClick"])])]),O((f(),C(D,{class:"detail-card"},{default:o(()=>[e.invoice?(f(),M(G,{key:0},[r[7]||(r[7]=u("div",{class:"section-title"},"基本信息",-1)),t(y,{column:3,border:""},{default:o(()=>[t(s,{label:"账单编号"},{default:o(()=>[i(l(e.invoice.invoiceNo),1)]),_:1}),t(s,{label:"生成日期"},{default:o(()=>[i(l(e.invoice.generatedDate),1)]),_:1}),t(s,{label:"账单状态"},{default:o(()=>[t(m,{type:e.getInvoiceStatusType(e.invoice.status)},{default:o(()=>[i(l(e.getInvoiceStatusText(e.invoice.status)),1)]),_:1},8,["type"])]),_:1}),t(s,{label:"账单金额"},{default:o(()=>[i(l(e.formatCurrency(e.invoice.totalAmount)),1)]),_:1}),t(s,{label:"已支付金额"},{default:o(()=>[i(l(e.formatCurrency(e.invoice.paidAmount)),1)]),_:1}),t(s,{label:"未支付金额"},{default:o(()=>[i(l(e.formatCurrency(e.invoice.unpaidAmount)),1)]),_:1}),t(s,{label:"创建人"},{default:o(()=>[i(l(e.invoice.createdBy),1)]),_:1}),t(s,{label:"创建时间"},{default:o(()=>[i(l(e.formatDateTime(e.invoice.createdAt)),1)]),_:1}),t(s,{label:"更新时间"},{default:o(()=>[i(l(e.formatDateTime(e.invoice.updatedAt)),1)]),_:1})]),_:1}),r[8]||(r[8]=u("div",{class:"section-title"},"客户信息",-1)),t(y,{column:3,border:""},{default:o(()=>[t(s,{label:"客户姓名"},{default:o(()=>{var a;return[i(l((a=e.invoice.passport)==null?void 0:a.name),1)]}),_:1}),t(s,{label:"护照号码"},{default:o(()=>{var a;return[i(l((a=e.invoice.passport)==null?void 0:a.passportNo),1)]}),_:1}),t(s,{label:"国籍"},{default:o(()=>{var a;return[i(l((a=e.invoice.passport)==null?void 0:a.nationality),1)]}),_:1})]),_:1}),r[9]||(r[9]=u("div",{class:"section-title"},"代理商信息",-1)),t(y,{column:3,border:""},{default:o(()=>[t(s,{label:"代理商名称"},{default:o(()=>{var a;return[i(l((a=e.invoice.agent)==null?void 0:a.name),1)]}),_:1}),t(s,{label:"联系人"},{default:o(()=>{var a;return[i(l((a=e.invoice.agent)==null?void 0:a.contactPerson),1)]}),_:1}),t(s,{label:"联系电话"},{default:o(()=>{var a;return[i(l((a=e.invoice.agent)==null?void 0:a.contactPhone),1)]}),_:1})]),_:1}),r[10]||(r[10]=u("div",{class:"section-title"},"关联订单",-1)),t(b,{data:e.invoice.orders,border:"",style:{width:"100%"}},{default:o(()=>[t(d,{prop:"orderNo",label:"订单编号",width:"180"}),t(d,{prop:"orderDate",label:"下单日期",width:"120"}),t(d,{prop:"orderStatus",label:"订单状态",width:"100"},{default:o(a=>[t(m,{type:e.getOrderStatusType(a.row.orderStatus)},{default:o(()=>[i(l(e.getOrderStatusText(a.row.orderStatus)),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"amount",label:"金额",width:"120"},{default:o(a=>[i(l(e.formatCurrency(a.row.amount)),1)]),_:1}),t(d,{prop:"status",label:"状态",width:"100"},{default:o(a=>[t(m,{type:a.row.status==="active"?"success":"info"},{default:o(()=>[i(l(a.row.status==="active"?"有效":"取消"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),r[11]||(r[11]=u("div",{class:"section-title"},"支付记录",-1)),t(b,{data:e.payments,border:"",style:{width:"100%"}},{default:o(()=>[t(d,{prop:"paymentAmount",label:"支付金额",width:"120"},{default:o(a=>[i(l(e.formatCurrency(a.row.paymentAmount)),1)]),_:1}),t(d,{prop:"paymentMethod",label:"支付方式",width:"120"},{default:o(a=>[i(l(e.getPaymentMethodText(a.row.paymentMethod)),1)]),_:1}),t(d,{prop:"paymentDate",label:"支付日期",width:"120"}),t(d,{prop:"paymentStatus",label:"支付状态",width:"100"},{default:o(a=>[t(m,{type:e.getPaymentStatusType(a.row.paymentStatus)},{default:o(()=>[i(l(e.getPaymentStatusText(a.row.paymentStatus)),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"reviewedBy",label:"审核人",width:"120"}),t(d,{prop:"reviewedAt",label:"审核时间",width:"180"}),t(d,{prop:"reviewRemarks",label:"审核备注","min-width":"150"}),t(d,{label:"凭证",width:"100"},{default:o(a=>[a.row.voucherUrl?(f(),C(p,{key:0,size:"small",type:"primary",onClick:x=>e.previewVoucher(a.row.voucherUrl)},{default:o(()=>r[6]||(r[6]=[i(" 查看 ")])),_:2},1032,["onClick"])):(f(),M("span",ne,"无"))]),_:1})]),_:1},8,["data"]),r[12]||(r[12]=u("div",{class:"section-title"},"备注信息",-1)),t(h,{type:"textarea",rows:3,modelValue:e.invoice.remarks,"onUpdate:modelValue":r[0]||(r[0]=a=>e.invoice.remarks=a),readonly:"",placeholder:"暂无备注"},null,8,["modelValue"])],64)):J("",!0)]),_:1})),[[S,e.loading]]),t(k,{modelValue:e.voucherDialogVisible,"onUpdate:modelValue":r[1]||(r[1]=a=>e.voucherDialogVisible=a),title:"支付凭证",width:"50%"},{default:o(()=>[u("div",re,[u("img",{src:e.currentVoucherUrl,alt:"支付凭证",style:{"max-width":"100%"}},null,8,ie)])]),_:1},8,["modelValue"])])}const fe=N(ee,[["render",le],["__scopeId","data-v-fbe04420"]]);export{fe as default};
