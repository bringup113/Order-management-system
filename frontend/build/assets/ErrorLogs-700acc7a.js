import{_ as C,r as I,aa as V,c as B,x as U,ab as n,ac as _,o as c,e as m,i as f,f as r,w as l,I as W,t as M,A as P,a5 as K,n as s,X as A,Y as x,z as d,k as T,Z as E,W as G,s as Y,g as z,T as H,D as j,F as J,G as X,R as Z,S as q,V as Q}from"./index-518491b2.js";/* empty css                   *//* empty css                             *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                *//* empty css                     *//* empty css                  */const $={name:"ErrorLogs",setup(){const y=I(V.getLogs()),t=B({type:"",level:""}),v=I(!1),e=I(null),D=U(()=>y.value.filter(o=>!(t.type&&o.error.type!==t.type||t.level&&o.error.level!==t.level)));return{logs:y,filteredLogs:D,filterForm:t,detailDialogVisible:v,selectedError:e,ErrorType:n,ErrorLevel:_,applyFilter:()=>{},resetFilter:()=>{t.type="",t.level=""},clearLogs:()=>{W.confirm("确定要清空所有错误日志吗？此操作不可恢复！","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V.clearLogs(),y.value=[]}).catch(()=>{})},showErrorDetail:o=>{e.value=o,v.value=!0},formatDate:o=>new Date(o).toLocaleString(),formatDetails:o=>typeof o=="object"?JSON.stringify(o,null,2):o,getErrorTypeLabel:o=>({[n.API]:"API错误",[n.VALIDATION]:"验证错误",[n.BUSINESS]:"业务错误",[n.NETWORK]:"网络错误",[n.AUTH]:"认证错误",[n.PERMISSION]:"权限错误",[n.SYSTEM]:"系统错误",[n.UNKNOWN]:"未知错误"})[o]||o,getErrorLevelLabel:o=>({[_.INFO]:"信息",[_.WARNING]:"警告",[_.ERROR]:"错误",[_.FATAL]:"致命错误"})[o]||o,getErrorTypeTagType:o=>({[n.API]:"danger",[n.VALIDATION]:"warning",[n.BUSINESS]:"warning",[n.NETWORK]:"danger",[n.AUTH]:"danger",[n.PERMISSION]:"warning",[n.SYSTEM]:"danger",[n.UNKNOWN]:"info"})[o]||"info",getErrorLevelTagType:o=>({[_.INFO]:"info",[_.WARNING]:"warning",[_.ERROR]:"danger",[_.FATAL]:"danger"})[o]||"info"}}},ee={class:"error-logs-container"},re={class:"page-header"},le={class:"header-actions"},te={key:0,class:"empty-logs"},oe={key:1},ae={key:0,class:"error-detail"},ne={key:0,class:"error-stack"},se={key:1,class:"error-details"};function ie(y,t,v,e,D,h){const p=M,L=Q,w=G,u=Y,F=z,N=P,S=H,g=j,k=J,o=X,i=Z,O=q,R=K;return c(),m("div",ee,[f("div",re,[t[4]||(t[4]=f("h1",null,"错误日志",-1)),f("div",le,[r(p,{type:"danger",onClick:e.clearLogs,disabled:!e.logs.length},{default:l(()=>t[3]||(t[3]=[s("清空日志")])),_:1},8,["onClick","disabled"])])]),r(N,{class:"filter-container"},{default:l(()=>[r(F,{inline:!0,model:e.filterForm},{default:l(()=>[r(u,{label:"错误类型"},{default:l(()=>[r(w,{modelValue:e.filterForm.type,"onUpdate:modelValue":t[0]||(t[0]=a=>e.filterForm.type=a),placeholder:"选择错误类型",clearable:""},{default:l(()=>[(c(!0),m(A,null,x(e.ErrorType,(a,b)=>(c(),T(L,{key:b,label:e.getErrorTypeLabel(a),value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(u,{label:"错误级别"},{default:l(()=>[r(w,{modelValue:e.filterForm.level,"onUpdate:modelValue":t[1]||(t[1]=a=>e.filterForm.level=a),placeholder:"选择错误级别",clearable:""},{default:l(()=>[(c(!0),m(A,null,x(e.ErrorLevel,(a,b)=>(c(),T(L,{key:b,label:e.getErrorLevelLabel(a),value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(u,null,{default:l(()=>[r(p,{type:"primary",onClick:e.applyFilter},{default:l(()=>t[5]||(t[5]=[s("筛选")])),_:1},8,["onClick"]),r(p,{onClick:e.resetFilter},{default:l(()=>t[6]||(t[6]=[s("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),r(N,{class:"logs-container"},{default:l(()=>[e.filteredLogs.length?(c(),m("div",oe,[r(o,{data:e.filteredLogs,border:"",style:{width:"100%"}},{default:l(()=>[r(g,{prop:"timestamp",label:"时间",width:"180",sortable:""},{default:l(a=>[s(d(e.formatDate(a.row.timestamp)),1)]),_:1}),r(g,{prop:"error.type",label:"类型",width:"120"},{default:l(a=>[r(k,{type:e.getErrorTypeTagType(a.row.error.type)},{default:l(()=>[s(d(e.getErrorTypeLabel(a.row.error.type)),1)]),_:2},1032,["type"])]),_:1}),r(g,{prop:"error.level",label:"级别",width:"100"},{default:l(a=>[r(k,{type:e.getErrorLevelTagType(a.row.error.level)},{default:l(()=>[s(d(e.getErrorLevelLabel(a.row.error.level)),1)]),_:2},1032,["type"])]),_:1}),r(g,{prop:"error.message",label:"错误信息","min-width":"250","show-overflow-tooltip":""}),r(g,{prop:"context.url",label:"页面路径","min-width":"200","show-overflow-tooltip":""}),r(g,{label:"操作",width:"120",fixed:"right"},{default:l(a=>[r(p,{type:"primary",size:"small",onClick:b=>e.showErrorDetail(a.row)},{default:l(()=>t[7]||(t[7]=[s("详情")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),m("div",te,[r(S,{description:"暂无错误日志"})]))]),_:1}),r(R,{modelValue:e.detailDialogVisible,"onUpdate:modelValue":t[2]||(t[2]=a=>e.detailDialogVisible=a),title:"错误详情",width:"70%"},{default:l(()=>[e.selectedError?(c(),m("div",ae,[r(O,{column:1,border:""},{default:l(()=>[r(i,{label:"时间"},{default:l(()=>[s(d(e.formatDate(e.selectedError.timestamp)),1)]),_:1}),r(i,{label:"类型"},{default:l(()=>[s(d(e.getErrorTypeLabel(e.selectedError.error.type)),1)]),_:1}),r(i,{label:"级别"},{default:l(()=>[s(d(e.getErrorLevelLabel(e.selectedError.error.level)),1)]),_:1}),r(i,{label:"错误名称"},{default:l(()=>[s(d(e.selectedError.error.name),1)]),_:1}),r(i,{label:"错误消息"},{default:l(()=>[s(d(e.selectedError.error.message),1)]),_:1}),e.selectedError.error.code?(c(),T(i,{key:0,label:"错误代码"},{default:l(()=>[s(d(e.selectedError.error.code),1)]),_:1})):E("",!0),r(i,{label:"页面路径"},{default:l(()=>[s(d(e.selectedError.context.url),1)]),_:1}),r(i,{label:"用户代理"},{default:l(()=>[s(d(e.selectedError.context.userAgent),1)]),_:1}),e.selectedError.context.userId?(c(),T(i,{key:1,label:"用户ID"},{default:l(()=>[s(d(e.selectedError.context.userId),1)]),_:1})):E("",!0)]),_:1}),e.selectedError.error.stack?(c(),m("div",ne,[t[8]||(t[8]=f("h3",null,"错误堆栈",-1)),f("pre",null,d(e.selectedError.error.stack),1)])):E("",!0),e.selectedError.error.details?(c(),m("div",se,[t[9]||(t[9]=f("h3",null,"错误详情",-1)),f("pre",null,d(e.formatDetails(e.selectedError.error.details)),1)])):E("",!0)])):E("",!0)]),_:1},8,["modelValue"])])}const ue=C($,[["render",ie],["__scopeId","data-v-21cb9c44"]]);export{ue as default};
