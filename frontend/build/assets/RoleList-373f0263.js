import{_ as Y,r,c as D,y as $,o as B,e as K,i as _,f as l,w as s,H as ee,E as c,I as q,t as ae,A as le,a5 as te,n as m,J as N,k as oe,z as U,q as se,s as ne,V as re,W as ie,g as de,D as ce,F as me,G as ue,K as fe,N as pe,O as ve,a9 as ge,L as _e}from"./index-518491b2.js";/* empty css                   *//* empty css                        *//* empty css                   *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                *//* empty css                     */import{a as ye,e as he,f as I,h as be,i as Ce,j as Ve,k as ke}from"./system-15735185.js";const we={name:"RoleList",setup(){const x=r(!1),e=r(!1),F=r(!1),a=r([]),T=r(0),y=r(1),i=r(10),v=r(null),d=r(null),h=r(null),k=r(!1),w=r(!1),b=r(!1),u=r(null),z=r(null),E=r([]),C=r([]),V=D({name:"",code:"",status:""}),f=D({name:"",code:"",description:"",status:"active"}),S=D({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"角色编码只能包含字母、数字和下划线",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),p=async()=>{x.value=!0;try{const t={page:y.value,limit:i.value,name:V.name,code:V.code,status:V.status},n=await ye(t),{data:g,total:L}=ee(n);a.value=g,T.value=L}catch(t){console.error("获取角色列表失败:",t),c.error("获取角色列表失败"),a.value=[{id:1,name:"管理员",code:"admin",description:"系统管理员，拥有所有权限",status:"active",createdAt:"2023-01-01 00:00:00"},{id:2,name:"操作员",code:"operator",description:"系统操作员，拥有部分操作权限",status:"active",createdAt:"2023-01-02 00:00:00"},{id:3,name:"访客",code:"guest",description:"系统访客，只有查看权限",status:"active",createdAt:"2023-01-03 00:00:00"}],T.value=a.value.length}finally{x.value=!1}},P=async()=>{try{const t=await Ve();E.value=t.data||[]}catch(t){console.error("获取权限列表失败:",t),E.value=[{id:1,name:"系统管理",code:"system",children:[{id:11,name:"用户管理",code:"system:user",children:[{id:111,name:"用户查询",code:"system:user:list"},{id:112,name:"用户创建",code:"system:user:create"},{id:113,name:"用户编辑",code:"system:user:update"},{id:114,name:"用户删除",code:"system:user:delete"}]},{id:12,name:"角色管理",code:"system:role",children:[{id:121,name:"角色查询",code:"system:role:list"},{id:122,name:"角色创建",code:"system:role:create"},{id:123,name:"角色编辑",code:"system:role:update"},{id:124,name:"角色删除",code:"system:role:delete"},{id:125,name:"权限设置",code:"system:role:permission"}]}]},{id:2,name:"订单管理",code:"order",children:[{id:21,name:"订单查询",code:"order:list"},{id:22,name:"订单创建",code:"order:create"},{id:23,name:"订单编辑",code:"order:update"},{id:24,name:"订单删除",code:"order:delete"}]},{id:3,name:"产品管理",code:"product",children:[{id:31,name:"产品查询",code:"product:list"},{id:32,name:"产品创建",code:"product:create"},{id:33,name:"产品编辑",code:"product:update"},{id:34,name:"产品删除",code:"product:delete"}]}]}},o=async t=>{F.value=!0;try{const n=await ke(t);C.value=n.data||[]}catch(n){console.error("获取角色权限失败:",n),t===1?C.value=[1,11,12,111,112,113,114,121,122,123,124,125,2,21,22,23,24,3,31,32,33,34]:t===2?C.value=[1,11,111,2,21,22,23,3,31,32,33]:t===3&&(C.value=[1,11,111,2,21,3,31])}finally{F.value=!1}},R=()=>{y.value=1,p()},M=()=>{v.value&&v.value.resetFields(),y.value=1,p()},j=t=>{y.value=t,p()},G=t=>{i.value=t,y.value=1,p()},H=()=>{b.value=!1,u.value=null,A(),k.value=!0},O=t=>{if(t.code==="admin"){c.warning("不能编辑管理员角色");return}b.value=!0,u.value=t.id,A(),f.name=t.name,f.code=t.code,f.description=t.description,f.status=t.status,k.value=!0},J=async t=>{u.value=t.id,z.value=t,E.value.length===0&&await P(),await o(t.id),w.value=!0},W=async()=>{if(h.value){e.value=!0;try{const t=h.value.getCheckedKeys(),n=h.value.getHalfCheckedKeys(),g=[...t,...n];await he(u.value,{permissionIds:g}),c.success("权限设置成功"),w.value=!1}catch(t){console.error("保存权限设置失败:",t),c.error("保存权限设置失败")}finally{e.value=!1}}},Z=t=>{if(t.code==="admin"){c.warning("不能修改管理员角色状态");return}const n=t.status==="active"?"inactive":"active",g=n==="active"?"启用":"禁用";q.confirm(`确定要${g}角色 "${t.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await I(t.id,{status:n}),c.success(`${g}成功`),p()}catch(L){console.error(`${g}角色失败:`,L),c.error(`${g}角色失败`)}}).catch(()=>{})},Q=t=>{if(t.code==="admin"){c.warning("不能删除管理员角色");return}q.confirm(`确定要删除角色 "${t.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await be(t.id),c.success("删除成功"),p()}catch(n){console.error("删除角色失败:",n),c.error("删除角色失败")}}).catch(()=>{})},A=()=>{f.name="",f.code="",f.description="",f.status="active",d.value&&d.value.resetFields()},X=async()=>{d.value&&await d.value.validate(async t=>{if(t){e.value=!0;try{const n={...f};b.value?(await I(u.value,n),c.success("角色更新成功")):(await Ce(n),c.success("角色创建成功")),k.value=!1,p()}catch(n){console.error("保存角色失败:",n),c.error("保存角色失败")}finally{e.value=!1}}else return c.warning("请填写必填项"),!1})};return $(()=>{p()}),{loading:x,submitting:e,permissionLoading:F,roleList:a,total:T,currentPage:y,pageSize:i,searchForm:V,searchFormRef:v,form:f,formRef:d,rules:S,dialogVisible:k,permissionDialogVisible:w,isEdit:b,currentRole:z,permissionTree:E,permissionTreeRef:h,checkedPermissions:C,handleSearch:R,resetSearch:M,handleCurrentChange:j,handleSizeChange:G,handleCreate:H,handleEdit:O,handlePermission:J,submitPermissions:W,handleStatusChange:Z,handleDelete:Q,submitForm:X}}},Ee={class:"role-list-container"},Re={class:"page-header"},xe={class:"header-actions"},Fe={class:"pagination-container"},Te={class:"dialog-footer"},ze={class:"permission-header"},Se={class:"dialog-footer"};function Pe(x,e,F,a,T,y){const i=ae,v=se,d=ne,h=re,k=ie,w=de,b=le,u=ce,z=me,E=ue,C=fe,V=pe,f=ve,S=te,p=ge,P=_e;return B(),K("div",Ee,[_("div",Re,[e[12]||(e[12]=_("h1",null,"角色管理",-1)),_("div",xe,[l(i,{type:"primary",onClick:a.handleCreate},{default:s(()=>e[11]||(e[11]=[m("创建角色")])),_:1},8,["onClick"])])]),l(b,{class:"search-card"},{default:s(()=>[l(w,{inline:!0,model:a.searchForm,ref:"searchFormRef",class:"search-form"},{default:s(()=>[l(d,{label:"角色名称",prop:"name"},{default:s(()=>[l(v,{modelValue:a.searchForm.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.searchForm.name=o),placeholder:"请输入角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"角色编码",prop:"code"},{default:s(()=>[l(v,{modelValue:a.searchForm.code,"onUpdate:modelValue":e[1]||(e[1]=o=>a.searchForm.code=o),placeholder:"请输入角色编码",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"状态",prop:"status"},{default:s(()=>[l(k,{modelValue:a.searchForm.status,"onUpdate:modelValue":e[2]||(e[2]=o=>a.searchForm.status=o),placeholder:"请选择状态",clearable:""},{default:s(()=>[l(h,{label:"启用",value:"active"}),l(h,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:s(()=>[l(i,{type:"primary",onClick:a.handleSearch},{default:s(()=>e[13]||(e[13]=[m("查询")])),_:1},8,["onClick"]),l(i,{onClick:a.resetSearch},{default:s(()=>e[14]||(e[14]=[m("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),l(b,{class:"list-card"},{default:s(()=>[N((B(),oe(E,{data:a.roleList,border:"",style:{width:"100%"}},{default:s(()=>[l(u,{prop:"name",label:"角色名称",width:"150"}),l(u,{prop:"code",label:"角色编码",width:"150"}),l(u,{prop:"description",label:"角色描述","min-width":"200"}),l(u,{prop:"status",label:"状态",width:"100"},{default:s(o=>[l(z,{type:o.row.status==="active"?"success":"danger"},{default:s(()=>[m(U(o.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"createdAt",label:"创建时间",width:"180"}),l(u,{label:"操作",width:"250"},{default:s(o=>[l(i,{size:"small",onClick:R=>a.handleEdit(o.row),disabled:o.row.code==="admin"},{default:s(()=>e[15]||(e[15]=[m(" 编辑 ")])),_:2},1032,["onClick","disabled"]),l(i,{size:"small",type:"primary",onClick:R=>a.handlePermission(o.row)},{default:s(()=>e[16]||(e[16]=[m(" 权限设置 ")])),_:2},1032,["onClick"]),l(i,{size:"small",type:o.row.status==="active"?"danger":"success",onClick:R=>a.handleStatusChange(o.row),disabled:o.row.code==="admin"},{default:s(()=>[m(U(o.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick","disabled"]),l(i,{size:"small",type:"danger",onClick:R=>a.handleDelete(o.row),disabled:o.row.code==="admin"},{default:s(()=>e[17]||(e[17]=[m(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[P,a.loading]]),_("div",Fe,[l(C,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:a.total,"page-size":a.pageSize,"current-page":a.currentPage,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1}),l(S,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[8]||(e[8]=o=>a.dialogVisible=o),title:a.isEdit?"编辑角色":"创建角色",width:"500px"},{footer:s(()=>[_("span",Te,[l(i,{onClick:e[7]||(e[7]=o=>a.dialogVisible=!1)},{default:s(()=>e[20]||(e[20]=[m("取消")])),_:1}),l(i,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:s(()=>e[21]||(e[21]=[m(" 确认 ")])),_:1},8,["onClick","loading"])])]),default:s(()=>[l(w,{ref:"formRef",model:a.form,rules:a.rules,"label-width":"100px"},{default:s(()=>[l(d,{label:"角色名称",prop:"name"},{default:s(()=>[l(v,{modelValue:a.form.name,"onUpdate:modelValue":e[3]||(e[3]=o=>a.form.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"角色编码",prop:"code"},{default:s(()=>[l(v,{modelValue:a.form.code,"onUpdate:modelValue":e[4]||(e[4]=o=>a.form.code=o),placeholder:"请输入角色编码",disabled:a.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(d,{label:"角色描述",prop:"description"},{default:s(()=>[l(v,{type:"textarea",rows:3,modelValue:a.form.description,"onUpdate:modelValue":e[5]||(e[5]=o=>a.form.description=o),placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),l(d,{label:"状态",prop:"status"},{default:s(()=>[l(f,{modelValue:a.form.status,"onUpdate:modelValue":e[6]||(e[6]=o=>a.form.status=o)},{default:s(()=>[l(V,{label:"active"},{default:s(()=>e[18]||(e[18]=[m("启用")])),_:1}),l(V,{label:"inactive"},{default:s(()=>e[19]||(e[19]=[m("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(S,{modelValue:a.permissionDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=o=>a.permissionDialogVisible=o),title:"权限设置",width:"600px"},{footer:s(()=>[_("span",Se,[l(i,{onClick:e[9]||(e[9]=o=>a.permissionDialogVisible=!1)},{default:s(()=>e[22]||(e[22]=[m("取消")])),_:1}),l(i,{type:"primary",onClick:a.submitPermissions,loading:a.submitting},{default:s(()=>e[23]||(e[23]=[m(" 保存 ")])),_:1},8,["onClick","loading"])])]),default:s(()=>{var o;return[N((B(),K("div",null,[_("div",ze,[_("h3",null,U((o=a.currentRole)==null?void 0:o.name)+" 权限配置",1)]),l(p,{ref:"permissionTreeRef",data:a.permissionTree,"show-checkbox":"","node-key":"id",props:{label:"name",children:"children"},"default-checked-keys":a.checkedPermissions},null,8,["data","default-checked-keys"])])),[[P,a.permissionLoading]])]}),_:1},8,["modelValue"])])}const He=Y(we,[["render",Pe],["__scopeId","data-v-92c0ebcc"]]);export{He as default};
