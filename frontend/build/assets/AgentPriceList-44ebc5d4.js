import{_ as R,M as O,b as U,r as p,c as D,x as M,y as j,o as b,e as B,i as F,f as t,w as a,E as v,I as z,t as S,A as G,a5 as J,n as d,z as m,J as Q,k as T,Z as W,X,Y,R as Z,S as H,D as K,G as $,T as ee,W as te,s as oe,a2 as le,q as ae,g as re,L as ne,V as ie}from"./index-518491b2.js";/* empty css                   *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                             */import{i as se,j as de,k as ce,l as ue}from"./product-50d99a21.js";const me={name:"AgentPriceList",setup(){const V=O(),l=U(),y=p(null),e=p(!1),w=p(!1),_=p(!1),n=p(!1),s=D({id:null,productId:null,productName:"",supplierId:null,supplierName:"",costPrice:0,remark:""}),I=p([]),f=p([]),c=M(()=>n.value?"编辑代理价格":"新增代理价格"),r=D({id:null,quoteId:null,agentId:null,agentName:"",costPrice:0,salePrice:0,remark:""}),A={agentId:[{required:!0,message:"请选择代理",trigger:"change"}],costPrice:[{required:!0,message:"请输入成本价格",trigger:"blur"}],salePrice:[{required:!0,message:"请输入销售价格",trigger:"blur"}]},E=i=>{e.value=!0,setTimeout(()=>{Object.assign(s,{id:i,productId:1,productName:"日本东京5日游",supplierId:2,supplierName:"供应商B",costPrice:1999.99,remark:"这是一个备注"}),e.value=!1},500)},P=i=>{e.value=!0,se(i).then(u=>{I.value=u.data||[]}).catch(u=>{console.error("获取代理价格列表失败",u),v.error("获取代理价格列表失败")}).finally(()=>{e.value=!1})},g=()=>{f.value=[{id:1,name:"代理A"},{id:2,name:"代理B"},{id:3,name:"代理C"}]},k=i=>{const u=f.value.find(L=>L.id===i);u&&(r.agentName=u.name)},x=()=>{n.value=!1,h(),r.quoteId=s.id,r.costPrice=s.costPrice,r.salePrice=s.costPrice*1.2,_.value=!0},C=i=>{n.value=!0,h(),Object.assign(r,i),_.value=!0},q=i=>{z.confirm("确认删除该代理价格吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{de(i.id).then(()=>{v.success("删除成功"),P(s.id)}).catch(u=>{console.error("删除代理价格失败",u),v.error("删除代理价格失败")})}).catch(()=>{})},h=()=>{r.id=null,r.quoteId=null,r.agentId=null,r.agentName="",r.costPrice=0,r.salePrice=0,r.remark=""},o=()=>{y.value.validate(i=>{if(i)w.value=!0,(n.value?ce(r.id,r):ue(r.quoteId,r)).then(()=>{v.success(n.value?"修改成功":"添加成功"),_.value=!1,P(s.id)}).catch(L=>{console.error(n.value?"修改代理价格失败":"添加代理价格失败",L),v.error(n.value?"修改代理价格失败":"添加代理价格失败")}).finally(()=>{w.value=!1});else return!1})},N=()=>{l.push(`/product/detail/${s.productId}`)};return j(()=>{if(g(),V.params.id){const i=V.params.id;E(i),P(i)}}),{formRef:y,loading:e,submitLoading:w,dialogVisible:_,dialogTitle:c,isEdit:n,quoteInfo:s,agentPriceList:I,agentOptions:f,form:r,rules:A,handleAgentChange:k,handleAddAgentPrice:x,handleEditAgentPrice:C,handleDeleteAgentPrice:q,submitForm:o,goBack:N}}},pe={class:"agent-price-list-container"},fe={class:"agent-price-list-header"},ge={key:0,class:"empty-data"},_e={class:"dialog-footer"};function Pe(V,l,y,e,w,_){const n=S,s=Z,I=H,f=G,c=K,r=$,A=ee,E=ie,P=te,g=oe,k=le,x=ae,C=re,q=J,h=ne;return b(),B("div",pe,[F("div",fe,[l[7]||(l[7]=F("h2",null,"代理产品价格管理",-1)),t(n,{type:"primary",onClick:e.handleAddAgentPrice},{default:a(()=>l[6]||(l[6]=[d("新增代理价格")])),_:1},8,["onClick"])]),t(f,{class:"info-container"},{default:a(()=>[t(I,{title:"产品报价信息",column:2,border:""},{default:a(()=>[t(s,{label:"产品名称"},{default:a(()=>[d(m(e.quoteInfo.productName),1)]),_:1}),t(s,{label:"供应商"},{default:a(()=>[d(m(e.quoteInfo.supplierName),1)]),_:1}),t(s,{label:"成本价格"},{default:a(()=>[d(m(e.quoteInfo.costPrice?`${e.quoteInfo.costPrice.toFixed(2)} 元`:"-"),1)]),_:1}),t(s,{label:"备注"},{default:a(()=>[d(m(e.quoteInfo.remark||"无"),1)]),_:1})]),_:1})]),_:1}),t(f,{class:"table-container"},{default:a(()=>[Q((b(),T(r,{data:e.agentPriceList,border:"",style:{width:"100%"}},{default:a(()=>[t(c,{prop:"agentName",label:"代理名称",width:"150"}),t(c,{prop:"costPrice",label:"成本价格",width:"120"},{default:a(o=>[d(m(o.row.costPrice.toFixed(2))+" 元 ",1)]),_:1}),t(c,{prop:"salePrice",label:"销售价格",width:"120"},{default:a(o=>[d(m(o.row.salePrice.toFixed(2))+" 元 ",1)]),_:1}),t(c,{prop:"profit",label:"利润",width:"120"},{default:a(o=>[d(m((o.row.salePrice-o.row.costPrice).toFixed(2))+" 元 ",1)]),_:1}),t(c,{prop:"profitRate",label:"利润率",width:"120"},{default:a(o=>[d(m(((o.row.salePrice-o.row.costPrice)/o.row.costPrice*100).toFixed(2))+"% ",1)]),_:1}),t(c,{prop:"remark",label:"备注","show-overflow-tooltip":""}),t(c,{prop:"createdAt",label:"创建时间",width:"180"}),t(c,{label:"操作",width:"150"},{default:a(o=>[t(n,{size:"small",type:"primary",onClick:N=>e.handleEditAgentPrice(o.row)},{default:a(()=>l[8]||(l[8]=[d("编辑")])),_:2},1032,["onClick"]),t(n,{size:"small",type:"danger",onClick:N=>e.handleDeleteAgentPrice(o.row)},{default:a(()=>l[9]||(l[9]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[h,e.loading]]),e.agentPriceList.length===0?(b(),B("div",ge,[t(A,{description:"暂无代理价格信息"})])):W("",!0)]),_:1}),t(q,{title:e.dialogTitle,modelValue:e.dialogVisible,"onUpdate:modelValue":l[5]||(l[5]=o=>e.dialogVisible=o),width:"500px","close-on-click-modal":!1},{footer:a(()=>[F("span",_e,[t(n,{onClick:l[4]||(l[4]=o=>e.dialogVisible=!1)},{default:a(()=>l[10]||(l[10]=[d("取消")])),_:1}),t(n,{type:"primary",onClick:e.submitForm,loading:e.submitLoading},{default:a(()=>l[11]||(l[11]=[d("确定")])),_:1},8,["onClick","loading"])])]),default:a(()=>[t(C,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"100px","label-position":"right"},{default:a(()=>[t(g,{label:"代理",prop:"agentId"},{default:a(()=>[t(P,{modelValue:e.form.agentId,"onUpdate:modelValue":l[0]||(l[0]=o=>e.form.agentId=o),placeholder:"请选择代理",filterable:"",onChange:e.handleAgentChange},{default:a(()=>[(b(!0),B(X,null,Y(e.agentOptions,o=>(b(),T(E,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),t(g,{label:"成本价格",prop:"costPrice"},{default:a(()=>[t(k,{modelValue:e.form.costPrice,"onUpdate:modelValue":l[1]||(l[1]=o=>e.form.costPrice=o),precision:2,step:.1,min:0,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(g,{label:"销售价格",prop:"salePrice"},{default:a(()=>[t(k,{modelValue:e.form.salePrice,"onUpdate:modelValue":l[2]||(l[2]=o=>e.form.salePrice=o),precision:2,step:.1,min:0,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(g,{label:"备注",prop:"remark"},{default:a(()=>[t(x,{modelValue:e.form.remark,"onUpdate:modelValue":l[3]||(l[3]=o=>e.form.remark=o),type:"textarea",placeholder:"请输入备注信息",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}const Ne=R(me,[["render",Pe],["__scopeId","data-v-187a32c2"]]);export{Ne as default};
