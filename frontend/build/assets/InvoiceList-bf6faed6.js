import{_ as z,b as R,r as m,c as L,y as T,o as A,e as M,i as y,f as e,w as l,H as B,E as S,I as P,t as U,A as Y,n as c,J,k as j,z as b,q,s as G,V as H,W as K,P as O,g as W,D as Q,F as X,G as Z,K as $,L as ee}from"./index-518491b2.js";/* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                     *//* empty css                       */import{g as ae,d as te}from"./invoice-101f2e3d.js";const oe={name:"InvoiceList",setup(){const p=R(),t=m(!1),_=m([]),a=m(0),u=m(1),f=m(10),s=m(null),i=L({invoiceNo:"",customerName:"",status:"",dateRange:[]}),r=async()=>{t.value=!0;try{const n={page:u.value,limit:f.value,invoiceNo:i.invoiceNo,customerName:i.customerName,status:i.status};i.dateRange&&i.dateRange.length===2&&(n.startDate=i.dateRange[0],n.endDate=i.dateRange[1]);const h=await ae(n),{data:D,total:x}=B(h);_.value=D,a.value=x}catch(n){console.error("获取账单列表失败:",n),S.error("获取账单列表失败"),_.value=[{id:1,invoiceNo:"INV20230001",generatedDate:"2023-01-15",status:"partial",totalAmount:5e3,paidAmount:2e3,unpaidAmount:3e3,passport:{name:"张三"},agent:{name:"北京旅行社"}},{id:2,invoiceNo:"INV20230002",generatedDate:"2023-01-20",status:"unpaid",totalAmount:3e3,paidAmount:0,unpaidAmount:3e3,passport:{name:"李四"},agent:{name:"上海旅行社"}},{id:3,invoiceNo:"INV20230003",generatedDate:"2023-01-25",status:"paid",totalAmount:2e3,paidAmount:2e3,unpaidAmount:0,passport:{name:"John Smith"},agent:{name:"广州旅行社"}}],a.value=_.value.length}finally{t.value=!1}},g=()=>{u.value=1,r()},w=()=>{s.value&&s.value.resetFields(),u.value=1,r()},N=n=>{u.value=n,r()},k=n=>{f.value=n,u.value=1,r()},C=()=>{p.push({name:"InvoiceCreate"})},d=n=>{p.push({name:"InvoiceDetail",params:{id:n.id}})},I=n=>{p.push({name:"InvoiceEdit",params:{id:n.id}})},V=n=>{p.push({name:"InvoicePayments",params:{id:n.id}})},E=n=>{P.confirm("确定要删除这个账单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await te(n.id),S.success("删除成功"),r()}catch(h){console.error("删除账单失败:",h),S.error("删除账单失败")}}).catch(()=>{})},F=n=>({unpaid:"未支付",partial:"部分支付",paid:"已支付"})[n]||n,o=n=>({unpaid:"danger",partial:"warning",paid:"success"})[n]||"",v=n=>`¥ ${parseFloat(n).toFixed(2)}`;return T(()=>{r()}),{loading:t,invoiceList:_,total:a,currentPage:u,pageSize:f,searchForm:i,searchFormRef:s,handleSearch:g,resetSearch:w,handleCurrentChange:N,handleSizeChange:k,handleCreate:C,handleView:d,handleEdit:I,handlePayments:V,handleDelete:E,getInvoiceStatusText:F,getInvoiceStatusType:o,formatCurrency:v}}},ne={class:"invoice-list-container"},le={class:"page-header"},re={class:"header-actions"},se={class:"pagination-container"};function ie(p,t,_,a,u,f){const s=U,i=q,r=G,g=H,w=K,N=O,k=W,C=Y,d=Q,I=X,V=Z,E=$,F=ee;return A(),M("div",ne,[y("div",le,[t[5]||(t[5]=y("h1",null,"账单管理",-1)),y("div",re,[e(s,{type:"primary",onClick:a.handleCreate},{default:l(()=>t[4]||(t[4]=[c("创建账单")])),_:1},8,["onClick"])])]),e(C,{class:"search-card"},{default:l(()=>[e(k,{inline:!0,model:a.searchForm,ref:"searchFormRef",class:"search-form"},{default:l(()=>[e(r,{label:"账单编号",prop:"invoiceNo"},{default:l(()=>[e(i,{modelValue:a.searchForm.invoiceNo,"onUpdate:modelValue":t[0]||(t[0]=o=>a.searchForm.invoiceNo=o),placeholder:"请输入账单编号",clearable:""},null,8,["modelValue"])]),_:1}),e(r,{label:"客户姓名",prop:"customerName"},{default:l(()=>[e(i,{modelValue:a.searchForm.customerName,"onUpdate:modelValue":t[1]||(t[1]=o=>a.searchForm.customerName=o),placeholder:"请输入客户姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(r,{label:"账单状态",prop:"status"},{default:l(()=>[e(w,{modelValue:a.searchForm.status,"onUpdate:modelValue":t[2]||(t[2]=o=>a.searchForm.status=o),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(g,{label:"未支付",value:"unpaid"}),e(g,{label:"部分支付",value:"partial"}),e(g,{label:"已支付",value:"paid"})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"生成日期",prop:"dateRange"},{default:l(()=>[e(N,{modelValue:a.searchForm.dateRange,"onUpdate:modelValue":t[3]||(t[3]=o=>a.searchForm.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(s,{type:"primary",onClick:a.handleSearch},{default:l(()=>t[6]||(t[6]=[c("查询")])),_:1},8,["onClick"]),e(s,{onClick:a.resetSearch},{default:l(()=>t[7]||(t[7]=[c("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),e(C,{class:"list-card"},{default:l(()=>[J((A(),j(V,{data:a.invoiceList,border:"",style:{width:"100%"}},{default:l(()=>[e(d,{prop:"invoiceNo",label:"账单编号",width:"150"}),e(d,{prop:"passport.name",label:"客户姓名",width:"120"}),e(d,{prop:"agent.name",label:"代理商",width:"150"}),e(d,{prop:"totalAmount",label:"账单金额",width:"120"},{default:l(o=>[c(b(a.formatCurrency(o.row.totalAmount)),1)]),_:1}),e(d,{prop:"paidAmount",label:"已支付金额",width:"120"},{default:l(o=>[c(b(a.formatCurrency(o.row.paidAmount)),1)]),_:1}),e(d,{prop:"unpaidAmount",label:"未支付金额",width:"120"},{default:l(o=>[c(b(a.formatCurrency(o.row.unpaidAmount)),1)]),_:1}),e(d,{prop:"generatedDate",label:"生成日期",width:"120"}),e(d,{prop:"status",label:"状态",width:"100"},{default:l(o=>[e(I,{type:a.getInvoiceStatusType(o.row.status)},{default:l(()=>[c(b(a.getInvoiceStatusText(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"250"},{default:l(o=>[e(s,{size:"small",type:"primary",onClick:v=>a.handleView(o.row)},{default:l(()=>t[8]||(t[8]=[c(" 查看 ")])),_:2},1032,["onClick"]),e(s,{size:"small",type:"success",onClick:v=>a.handlePayments(o.row)},{default:l(()=>t[9]||(t[9]=[c(" 支付记录 ")])),_:2},1032,["onClick"]),e(s,{size:"small",onClick:v=>a.handleEdit(o.row),disabled:o.row.status==="paid"},{default:l(()=>t[10]||(t[10]=[c(" 编辑 ")])),_:2},1032,["onClick","disabled"]),e(s,{size:"small",type:"danger",onClick:v=>a.handleDelete(o.row),disabled:o.row.status==="paid"},{default:l(()=>t[11]||(t[11]=[c(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[F,a.loading]]),y("div",se,[e(E,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:a.total,"page-size":a.pageSize,"current-page":a.currentPage,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1})])}const ye=z(oe,[["render",ie],["__scopeId","data-v-4c39c1be"]]);export{ye as default};
