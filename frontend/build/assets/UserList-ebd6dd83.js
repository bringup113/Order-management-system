import{_ as Q,r as u,c as E,y as $,o as y,e as D,i as P,f as l,w as o,H as ee,E as c,I as B,t as ae,A as le,a5 as re,n as f,X as N,Y as O,J as oe,k as x,z as M,Z as G,q as se,s as te,V as ne,W as de,g as ie,D as me,F as ue,G as fe,K as ce,N as pe,O as ge,L as we}from"./index-518491b2.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                     */import{g as ve,a as be,r as Ve,u as _e,d as ye,b as he,c as Ce}from"./system-15735185.js";const ke={name:"UserList",setup(){const I=u(!1),e=u(!1),F=u([]),a=u(0),h=u(1),L=u(10),m=u(null),i=u(null),n=u(null),v=u(!1),C=u(!1),b=u(!1),V=u(null),p=u([]),k=E({username:"",name:"",roleId:"",status:""}),t=E({username:"",name:"",roleId:"",email:"",phone:"",password:"",confirmPassword:"",status:"active",remarks:""}),R=E({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,d,g)=>{d!==t.password?g(new Error("两次输入密码不一致")):g()},trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),_=E({password:"",confirmPassword:""}),S=E({password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,d,g)=>{d!==_.password?g(new Error("两次输入密码不一致")):g()},trigger:"blur"}]}),w=async()=>{I.value=!0;try{const s={page:h.value,limit:L.value,username:k.username,name:k.name,roleId:k.roleId,status:k.status},d=await ve(s),{data:g,total:T}=ee(d);F.value=g,a.value=T}catch(s){console.error("获取用户列表失败:",s),c.error("获取用户列表失败"),F.value=[{id:1,username:"admin",name:"系统管理员",role:{id:1,name:"管理员"},email:"admin@example.com",phone:"13800138000",status:"active",lastLoginTime:"2023-01-15 10:30:00",remarks:"系统超级管理员"},{id:2,username:"operator",name:"操作员",role:{id:2,name:"操作员"},email:"operator@example.com",phone:"13900139000",status:"active",lastLoginTime:"2023-01-16 14:20:00",remarks:"系统操作员"},{id:3,username:"guest",name:"访客",role:{id:3,name:"访客"},email:"guest@example.com",phone:"13700137000",status:"inactive",lastLoginTime:"2023-01-10 09:15:00",remarks:"系统访客"}],a.value=F.value.length}finally{I.value=!1}},z=async()=>{try{const s=await be();p.value=s.data||[]}catch(s){console.error("获取角色列表失败:",s),p.value=[{id:1,name:"管理员"},{id:2,name:"操作员"},{id:3,name:"访客"}]}},r=()=>{h.value=1,w()},U=()=>{m.value&&m.value.resetFields(),h.value=1,w()},j=s=>{h.value=s,w()},A=s=>{L.value=s,h.value=1,w()},H=()=>{b.value=!1,V.value=null,q(),v.value=!0},J=s=>{b.value=!0,V.value=s.id,q(),t.username=s.username,t.name=s.name,t.roleId=s.role.id,t.email=s.email,t.phone=s.phone,t.status=s.status,t.remarks=s.remarks,v.value=!0},K=s=>{V.value=s.id,_.password="",_.confirmPassword="",C.value=!0},W=async()=>{n.value&&await n.value.validate(async s=>{if(s){e.value=!0;try{await Ve(V.value,{password:_.password}),c.success("密码重置成功"),C.value=!1}catch(d){console.error("重置密码失败:",d),c.error("重置密码失败")}finally{e.value=!1}}else return c.warning("请填写必填项"),!1})},X=s=>{const d=s.status==="active"?"inactive":"active",g=d==="active"?"启用":"禁用";B.confirm(`确定要${g}用户 "${s.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _e(s.id,d),c.success(`${g}成功`),w()}catch(T){console.error(`${g}用户失败:`,T),c.error(`${g}用户失败`)}}).catch(()=>{})},Y=s=>{if(s.username==="admin"){c.warning("不能删除管理员账号");return}B.confirm(`确定要删除用户 "${s.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ye(s.id),c.success("删除成功"),w()}catch(d){console.error("删除用户失败:",d),c.error("删除用户失败")}}).catch(()=>{})},q=()=>{t.username="",t.name="",t.roleId="",t.email="",t.phone="",t.password="",t.confirmPassword="",t.status="active",t.remarks="",i.value&&i.value.resetFields()},Z=async()=>{i.value&&await i.value.validate(async s=>{if(s){e.value=!0;try{const d={...t};b.value?(delete d.password,delete d.confirmPassword,await he(V.value,d),c.success("用户更新成功")):(await Ce(d),c.success("用户创建成功")),v.value=!1,w()}catch(d){console.error("保存用户失败:",d),c.error("保存用户失败")}finally{e.value=!1}}else return c.warning("请填写必填项"),!1})};return $(()=>{w(),z()}),{loading:I,submitting:e,userList:F,total:a,currentPage:h,pageSize:L,searchForm:k,searchFormRef:m,form:t,formRef:i,rules:R,resetPasswordForm:_,resetPasswordFormRef:n,resetPasswordRules:S,dialogVisible:v,resetPasswordDialogVisible:C,isEdit:b,roleOptions:p,handleSearch:r,resetSearch:U,handleCurrentChange:j,handleSizeChange:A,handleCreate:H,handleEdit:J,handleResetPassword:K,submitResetPassword:W,handleStatusChange:X,handleDelete:Y,submitForm:Z}}},Pe={class:"user-list-container"},Fe={class:"page-header"},Ue={class:"header-actions"},Ee={class:"pagination-container"},xe={class:"dialog-footer"},Ie={class:"dialog-footer"};function Le(I,e,F,a,h,L){const m=ae,i=se,n=te,v=ne,C=de,b=ie,V=le,p=me,k=ue,t=fe,R=ce,_=pe,S=ge,w=re,z=we;return y(),D("div",Pe,[P("div",Fe,[e[20]||(e[20]=P("h1",null,"用户管理",-1)),P("div",Ue,[l(m,{type:"primary",onClick:a.handleCreate},{default:o(()=>e[19]||(e[19]=[f("创建用户")])),_:1},8,["onClick"])])]),l(V,{class:"search-card"},{default:o(()=>[l(b,{inline:!0,model:a.searchForm,ref:"searchFormRef",class:"search-form"},{default:o(()=>[l(n,{label:"用户名",prop:"username"},{default:o(()=>[l(i,{modelValue:a.searchForm.username,"onUpdate:modelValue":e[0]||(e[0]=r=>a.searchForm.username=r),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"姓名",prop:"name"},{default:o(()=>[l(i,{modelValue:a.searchForm.name,"onUpdate:modelValue":e[1]||(e[1]=r=>a.searchForm.name=r),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"角色",prop:"roleId"},{default:o(()=>[l(C,{modelValue:a.searchForm.roleId,"onUpdate:modelValue":e[2]||(e[2]=r=>a.searchForm.roleId=r),placeholder:"请选择角色",clearable:""},{default:o(()=>[(y(!0),D(N,null,O(a.roleOptions,r=>(y(),x(v,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"状态",prop:"status"},{default:o(()=>[l(C,{modelValue:a.searchForm.status,"onUpdate:modelValue":e[3]||(e[3]=r=>a.searchForm.status=r),placeholder:"请选择状态",clearable:""},{default:o(()=>[l(v,{label:"启用",value:"active"}),l(v,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:o(()=>[l(m,{type:"primary",onClick:a.handleSearch},{default:o(()=>e[21]||(e[21]=[f("查询")])),_:1},8,["onClick"]),l(m,{onClick:a.resetSearch},{default:o(()=>e[22]||(e[22]=[f("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{class:"list-card"},{default:o(()=>[oe((y(),x(t,{data:a.userList,border:"",style:{width:"100%"}},{default:o(()=>[l(p,{prop:"username",label:"用户名",width:"150"}),l(p,{prop:"name",label:"姓名",width:"120"}),l(p,{prop:"role.name",label:"角色",width:"120"}),l(p,{prop:"email",label:"邮箱",width:"180"}),l(p,{prop:"phone",label:"手机号",width:"120"}),l(p,{prop:"status",label:"状态",width:"100"},{default:o(r=>[l(k,{type:r.row.status==="active"?"success":"danger"},{default:o(()=>[f(M(r.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"lastLoginTime",label:"最后登录时间",width:"180"}),l(p,{label:"操作",width:"250"},{default:o(r=>[l(m,{size:"small",onClick:U=>a.handleEdit(r.row)},{default:o(()=>e[23]||(e[23]=[f(" 编辑 ")])),_:2},1032,["onClick"]),l(m,{size:"small",type:"warning",onClick:U=>a.handleResetPassword(r.row)},{default:o(()=>e[24]||(e[24]=[f(" 重置密码 ")])),_:2},1032,["onClick"]),l(m,{size:"small",type:r.row.status==="active"?"danger":"success",onClick:U=>a.handleStatusChange(r.row)},{default:o(()=>[f(M(r.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(m,{size:"small",type:"danger",onClick:U=>a.handleDelete(r.row),disabled:r.row.username==="admin"},{default:o(()=>e[25]||(e[25]=[f(" 删除 ")])),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[z,a.loading]]),P("div",Ee,[l(R,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:a.total,"page-size":a.pageSize,"current-page":a.currentPage,onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])])]),_:1}),l(w,{modelValue:a.dialogVisible,"onUpdate:modelValue":e[14]||(e[14]=r=>a.dialogVisible=r),title:a.isEdit?"编辑用户":"创建用户",width:"500px"},{footer:o(()=>[P("span",xe,[l(m,{onClick:e[13]||(e[13]=r=>a.dialogVisible=!1)},{default:o(()=>e[28]||(e[28]=[f("取消")])),_:1}),l(m,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:o(()=>e[29]||(e[29]=[f(" 确认 ")])),_:1},8,["onClick","loading"])])]),default:o(()=>[l(b,{ref:"formRef",model:a.form,rules:a.rules,"label-width":"100px"},{default:o(()=>[l(n,{label:"用户名",prop:"username"},{default:o(()=>[l(i,{modelValue:a.form.username,"onUpdate:modelValue":e[4]||(e[4]=r=>a.form.username=r),placeholder:"请输入用户名",disabled:a.isEdit},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"姓名",prop:"name"},{default:o(()=>[l(i,{modelValue:a.form.name,"onUpdate:modelValue":e[5]||(e[5]=r=>a.form.name=r),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(n,{label:"角色",prop:"roleId"},{default:o(()=>[l(C,{modelValue:a.form.roleId,"onUpdate:modelValue":e[6]||(e[6]=r=>a.form.roleId=r),placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[(y(!0),D(N,null,O(a.roleOptions,r=>(y(),x(v,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"邮箱",prop:"email"},{default:o(()=>[l(i,{modelValue:a.form.email,"onUpdate:modelValue":e[7]||(e[7]=r=>a.form.email=r),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(n,{label:"手机号",prop:"phone"},{default:o(()=>[l(i,{modelValue:a.form.phone,"onUpdate:modelValue":e[8]||(e[8]=r=>a.form.phone=r),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a.isEdit?G("",!0):(y(),x(n,{key:0,label:"密码",prop:"password"},{default:o(()=>[l(i,{modelValue:a.form.password,"onUpdate:modelValue":e[9]||(e[9]=r=>a.form.password=r),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),a.isEdit?G("",!0):(y(),x(n,{key:1,label:"确认密码",prop:"confirmPassword"},{default:o(()=>[l(i,{modelValue:a.form.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=r=>a.form.confirmPassword=r),type:"password",placeholder:"请确认密码"},null,8,["modelValue"])]),_:1})),l(n,{label:"状态",prop:"status"},{default:o(()=>[l(S,{modelValue:a.form.status,"onUpdate:modelValue":e[11]||(e[11]=r=>a.form.status=r)},{default:o(()=>[l(_,{label:"active"},{default:o(()=>e[26]||(e[26]=[f("启用")])),_:1}),l(_,{label:"inactive"},{default:o(()=>e[27]||(e[27]=[f("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"备注",prop:"remarks"},{default:o(()=>[l(i,{type:"textarea",rows:3,modelValue:a.form.remarks,"onUpdate:modelValue":e[12]||(e[12]=r=>a.form.remarks=r),placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(w,{modelValue:a.resetPasswordDialogVisible,"onUpdate:modelValue":e[18]||(e[18]=r=>a.resetPasswordDialogVisible=r),title:"重置密码",width:"400px"},{footer:o(()=>[P("span",Ie,[l(m,{onClick:e[17]||(e[17]=r=>a.resetPasswordDialogVisible=!1)},{default:o(()=>e[30]||(e[30]=[f("取消")])),_:1}),l(m,{type:"primary",onClick:a.submitResetPassword,loading:a.submitting},{default:o(()=>e[31]||(e[31]=[f(" 确认 ")])),_:1},8,["onClick","loading"])])]),default:o(()=>[l(b,{ref:"resetPasswordFormRef",model:a.resetPasswordForm,rules:a.resetPasswordRules,"label-width":"100px"},{default:o(()=>[l(n,{label:"新密码",prop:"password"},{default:o(()=>[l(i,{modelValue:a.resetPasswordForm.password,"onUpdate:modelValue":e[15]||(e[15]=r=>a.resetPasswordForm.password=r),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),l(n,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[l(i,{modelValue:a.resetPasswordForm.confirmPassword,"onUpdate:modelValue":e[16]||(e[16]=r=>a.resetPasswordForm.confirmPassword=r),type:"password",placeholder:"请确认新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Ae=Q(ke,[["render",Le],["__scopeId","data-v-64c445c5"]]);export{Ae as default};
